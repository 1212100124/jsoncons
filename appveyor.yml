build: false

os: Visual Studio 2015

platform:
  - x64
  - x86

# environment:
#  matrix:
#    - MINICONDA: C:\jsoncons-conda

environment:
  vsversion: none
  arch: default
  matrix:
    - platform: vs
      vsversion: 2015
      arch: x86
      FLAGS: ""

init:
  - git config --global core.autocrlf input

before_build:
  # - cd tests/build/cmake
  # Remove the following from the path, as it will interfere with
  # the MinGW builds
  - set PATH=%PATH:C:\Program Files\Git\usr\bin;=%
  - if %platform%==msvc call "C:\Program Files (x86)\Microsoft Visual Studio 12.0\VC\vcvarsall.bat"
  - if %platform%==msvc cmake -G "NMake Makefiles" -DBUILD_TESTS=ON -DCMAKE_INSTALL_PREFIX=%P%
  - if %platform%==vs (
      set "makecommand=Visual Studio"
    )
  - set "vcx=false"
  - set "vcs=false"
  - if %platform%==vs (
      set "vcx=true"
    )
  - if %vsversion%==2015 (
      set "makecommand=%makecommand% 14 %vsversion%"
    )
  - if %vsversion%==2017 (
      set "makecommand=%makecommand% 15 %vsversion%"
    )
  - if %arch%==x64 (
      set "makecommand=%makecommand% Win64"
    )
  - if %arch%==ARM (
      set "makecommand=%makecommand% ARM"
    )

  - if %platform%==vs cmake . -G "%makecommand%" -D BUILD_TESTS=1 -D CMAKE_BUILD_TYPE=Release .

install:
  - nmake test_jsoncons
  - cd tests

build_script:
  - .\test_jsoncons
